<html layout:decorate="~{/common/layout}">
<head>
    <title>커뮤니티</title>
</head>
<main layout:fragment="main">
    <div class="container my-12 mx-auto px-4 md:px-12">
        <div class="flex flex-wrap -mx-1 lg:-mx-4">

            <!-- Column -->
            <div th:each="article : ${articles}" class="my-1 px-1 w-1/2 md:w-1/3 lg:my-4 lg:px-4 lg:w-1/4">

                <!-- Article -->
                <article class="overflow-hidden rounded-lg shadow-lg">

                    <a th:href="|/article/${article.id}|">
                        <img alt="Placeholder" class="block h-auto w-full" src="https://picsum.photos/600/400/?random">
                    </a>

                    <header class="flex items-center justify-between leading-tight p-2 md:p-4">
                        <h1 class="truncate w-48 h-5 inline-block text-medium">
                            <a class="no-underline hover:underline text-black" th:href="|/article/${article.id}|">
                                [[ ${article.title} ]]
                            </a>
                        </h1>
                        <p class="text-grey-darker text-sm">
                            [[ ${article.convertRelativeTime()} ]]
                        </p>
                    </header>

                    <footer class="flex items-center justify-between leading-none p-2 md:p-4">
                        <a class="flex items-center no-underline hover:underline text-black" th:href="|/${article.user.username}|">
                            <img alt="Placeholder" class="block rounded-full" src="https://picsum.photos/32/32/?random">
                            <p class="truncate w-36 h-5 ml-2 text-sm">
                                [[ ${article.user.nickname} ]]
                            </p>
                        </a>
                        <th:block th:unless="${@rq.login}">
                        <a like-bok class="cursor-pointer no-underline text-grey-darker" th:href="@{/article/like(id=${article.id})}">
                        </th:block>
                        <th:block th:if="${@rq.login}">
                        <a like-bok class="cursor-pointer no-underline text-grey-darker" th:hx-get="@{/ajax/article/like(id=${article.id})}">
                        </th:block>
                            <span class="">[[ ${article.likes.size()} ]]</span>
                            <i th:if="${@articleServiceImpl.hasUserLiked(article.id)}" like-icon class="fa fa-heart"></i>
                            <i th:unless="${@articleServiceImpl.hasUserLiked(article.id)}" like-icon class="fa-regular fa-heart"></i>
                        </a>
                    </footer>

                </article>
                <!-- END Article -->

            </div>
            <!-- END Column -->
        </div>
    </div>

    <!--  pagination  -->
    <nav class="text-center mb-12" aria-label="Page navigation">
        <ul class="inline-flex space-x-2">

            <li>
                <button id="firstPageBtn" class="flex items-center justify-center w-10 h-10 text-indigo-600 transition-colors duration-150 rounded-full focus:shadow-outline hover:bg-indigo-100">
                    <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" fill-rule="evenodd"></path></svg>
                </button>
            </li>

            <li th:each="num : ${pageRange}" class="pageBtn">

                <th:block th:unless="${#strings.equals(param.page, num)}">
                    <button class="pagination-num">[[ ${num} ]]</button>
                </th:block>

                <th:block th:if="${#strings.equals(param.page, num)}">
                    <button class="pagination-num-current">[[ ${num} ]]</button>
                </th:block>

            </li>

            <li>
                <button id="endPageBtn" class="flex items-center justify-center w-10 h-10 text-indigo-600 transition-colors duration-150 bg-gray-100 rounded-full focus:shadow-outline hover:bg-indigo-100">
                    <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20"><path d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" fill-rule="evenodd"></path></svg>
                </button>
            </li>

        </ul>
    </nav>

    <script th:inline="javascript">
        /*<![CDATA[*/

        // 카테고리 기본 선택 속성 추가
        const selectedCategory = ([[${param.category}]] != null ? [[${param.category}]] : "ALL");
        if(selectedCategory == null){
            $("#category > option[value=ALL]").attr("selected", true);
        } else {
            $("#category > option[value="+selectedCategory+"]").attr("selected", true);
        }


        // 페이지 이동
        $(".pagination-num").on( 'click', (event) => {
            location.href = "/article?page=" + event.target.innerHTML + "&category=" + selectedCategory;
        })


        // 처음, 끝 페이지 이동
        $("#firstPageBtn").on( 'click', (event) => {
            location.href = "/article?page=1&category=" + selectedCategory;
        })
        $("#endPageBtn").on( 'click', (event) => {
            const endPage = [[ ${articles.getTotalPages()} ]]
            location.href = "/article?page=" + endPage + "&category=" + selectedCategory;
        })



        // 카테고리 변경
        $("#category").on("change", () => {
            $("#categoryForm").submit();
        })


        // 좋아요 아이콘 hover
        $('a[like-bok]').each(function() {
            const likeBox = $(this);
            likeBox.hover( () => {
                const likeIcon = likeBox.find('i');
                likeIcon.toggleClass("fa-regular");
                likeIcon.toggleClass("fa");
            });
        });


        /*]]>*/
    </script>
</main>
</html>
